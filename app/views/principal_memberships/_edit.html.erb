<%= form_for(@membership, :url => principal_membership_path(@principal, @membership),
                          :as => :membership,
                          :remote => request.xhr?,
                          :method => :put) do %>
  <p>
    <strong>
      <%= l(:label_role_plural) %>
      (<a onclick="$(this).closest('form').children('div.unused').toggle();"><%= l(:label_all) %></a>):
    </strong>
  </p>
  <% @roles.each do |role| %>
    <div<%= role_color_and_hide(role, @membership.project) %>>
      <%= check_box_tag 'membership[role_ids][]',
            role.id, @membership.roles.to_a.include?(role),
            :id => nil,
            :disabled => !@membership.role_editable?(role) %> <%= role.name %>
      <%= render_role_inheritance(@membership, role) %>
    </div>
  <% end %>
  <%= hidden_field_tag 'membership[role_ids][]', '', :id => nil %>
  <p>
    <%= submit_tag l(:button_save) %>
    <%= link_to_function l(:button_cancel),
                         "$('#member-#{@membership.id}-roles').show(); $('#member-#{@membership.id}-form').empty(); return false;" if request.xhr? %>
  </p>
<% end %>
